{% extends 'index.html' %}


{% block material %}
    <h2>Todas as vendas {{user_name}}</h2>
    
    <style>
        table {
            table-layout: fixed;
            width: 100%;
        }

        td, th {
            white-space: nowrap;
            overflow: visible;
            text-overflow: unset;
    }
    </style>

<div >
    <table class="table table-striped">
        <thead>
            <tr>
                <th scope="col">Cliente</th>
                <th scope="col">Serviço</th>
                <th scope="col">Telefone</th>
                <th scope="col">Consumo</th>
                <th scope="col">VL Empreendimento</th>
                <th scope="col">Comissão</th>
                <th scope="col">Status Venda</th>
                <th scope="col">Status Pagamento VD</th>
                <th scope="col">Foto Documento</th>
                <th scope="col">Foto Endereço</th>
                <th scope="col">Foto Contracheque</th>
                <th scope="col">Editar</th>
                <th scope="col">Remover</th>
            </tr>
        </thead>
        <tbody>
            {% for venda in vendas %}
            <tr>
                <td>
                    <a href="#" class="open-details" data-id="{{ venda.id }}">{{ venda.cliente }}</a>
                </td>
                <td>{{ venda.servico }}</td>
                <td>{{ venda.telefone }}</td>
                <td>KWH {{ venda.consumo }}</td>
                <td>R${{ venda.formatar_valor }}</td>
                <td>R${{ venda.formatar_comissao }}</td>
                <td>{{ venda.status_venda }}</td>
                <td>{{ venda.status_pg_vendedor }}</td>
                <td>
                    {% if venda.foto_documento %}
                    <a href="{{ venda.foto_documento.url }}" target="_blank">Documento</a>
                    {% else %}
                    —
                    {% endif %}
                </td>
                <td>
                    {% if venda.foto_endereco %}
                    <a href="{{ venda.foto_endereco.url }}" target="_blank">Endereço</a>
                    {% else %}
                    —
                    {% endif %}
                </td>
                <td>
                    {% if venda.foto_contracheque %}
                    <a href="{{ venda.foto_contracheque.url }}" target="_blank">Ct Cheque</a>
                    {% else %}
                    —
                    {% endif %}
                </td>
                <td><a href="#">Editar</a></td>
                <td><a href="#">Remover</a></td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<!-- Modal HTML -->
<div id="detailsModal" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="detailsModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="detailsModalLabel">Detalhes do Cliente</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p id="detailsContent">Carregando...</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fechar</button>
            </div>
        </div>
    </div>
</div>

<script>
    document.querySelectorAll('.open-details').forEach(link => {
    link.addEventListener('click', function(event) {
        event.preventDefault();
        const vendaId = this.dataset.id;

        // Fazer a requisição para buscar os detalhes
        fetch(`/venda/${vendaId}/detalhes/`)
            .then(response => response.json())
            .then(data => {
                // Preencher os detalhes com os valores retornados
                const detalhes = `
                    <strong>Cliente:</strong> ${data.cliente} <br>
                    <strong>Serviço:</strong> ${data.servico} <br>
                    <strong>Telefone:</strong> ${data.telefone} <br>
                    <strong>Consumo:</strong> KWH ${data.consumo} <br>
                    <strong>Valor Empreendimento:</strong> R$ ${data.valor_empreendimento} <br>
                    <strong>Comissão:</strong> R$ ${data.comissao} <br>
                    <strong>Status Venda:</strong> ${data.status_venda} <br>
                    <strong>Status Pagamento:</strong> ${data.status_pagamento} <br>
                `;
                document.getElementById('detailsContent').innerHTML = detalhes;

                // Exibir o modal
                const modal = new bootstrap.Modal(document.getElementById('detailsModal'));
                modal.show();
            })
            .catch(error => {
                console.error('Erro ao buscar os detalhes:', error);
                document.getElementById('detailsContent').innerHTML = 'Erro ao carregar os detalhes.';
            });
    });
});
</script>
{% endblock %}
