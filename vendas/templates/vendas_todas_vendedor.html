{% extends 'index.html' %}


{% block material %}
    <h2>Todas as vendas {{user_name}}</h2>
    
    <style>
        table {
            table-layout: fixed;
            width: 100%;
        }

        td, th {
            white-space: nowrap;
            overflow: visible;
            text-overflow: unset;
    }
    </style>

<div >
    <table class="table table-striped">
        <thead>
            <tr>
                <th scope="col">Cliente</th>
                <th scope="col">Serviço</th>
                <th scope="col">Telefone</th>
                <th scope="col">Consumo</th>
                <th scope="col">VL Empreendimento</th>
                <th scope="col">Comissão</th>
                <th scope="col">Status Venda</th>
                <th scope="col">Status Pagamento VD</th>
                <th scope="col">Editar</th>
                <th scope="col">Remover</th>
            </tr>
        </thead>
        <tbody>
            {% for venda in vendas %}
            <tr>
                <td>
                    <a href="{% url 'detalhes_venda' venda.id %}" class="open-details" data-id="{{ venda.id }}">{{ venda.cliente }}</a>
                </td>
                <td>{{ venda.servico }}</td>
                <td>{{ venda.telefone }}</td>
                <td>KWH {{ venda.consumo }}</td>
                <td>R${{ venda.formatar_valor }}</td>
                <td>R${{ venda.formatar_comissao }}</td>
                <td><a href=" {% url 'alterar_status_venda' venda.id %} ">{{ venda.status_venda }}</a></td>
                <td><a href=" {% url 'alterar_status_venda' venda.id %} ">{{ venda.status_pg_vendedor }}</a></td>
                <td><a href="#">Editar</a></td>
                <td><a href="#">Remover</a></td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>


<div id="detailsModal" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="detailsModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="detailsModalLabel">Detalhes do Cliente {{cliente}}</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p id="detailsContent">Carregando...</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fechar</button>
            </div>
        </div>
    </div>
</div>

<script>
    document.querySelectorAll('.open-details').forEach(link => {
        link.addEventListener('click', function(event) {
            event.preventDefault();
            const vendaId = this.dataset.id;

            
            fetch(`/vendas/vendas/${vendaId}/detalhes/`)
                .then(response => response.json())
                .then(data => {
                    
                    const detalhes = `
                        <strong>Cliente:</strong> ${data.cliente} <br>
                        <strong>Serviço:</strong> ${data.servico} <br>
                        <strong>Telefone:</strong> ${data.telefone} <br>
                        <strong>Consumo:</strong> KWH ${data.consumo} <br>
                        <strong>Email:</strong> ${data.email} <br>
                        <strong>Vendedor:</strong> ${data.vendendor} <br>
                        <strong>Mes:</strong> ${data.mes} <br>
                        <strong>Ano:</strong> ${data.ano} <br>
                        <strong>Valor Empreendimento:</strong> R$ ${data.valor} <br>
                        <strong>Valor Comissão:</strong> R$ ${data.comissao} <br>
                        <strong>Status Venda:</strong> ${data.status_venda} <br>
                        <strong>Status Pagamento:</strong> ${data.status_pagamento} <br>
                        <strong>Documento Cliente:</strong>  ${data.foto_documento} <br>
                        <strong>Comprovante de Enderaço:</strong> ${data.foto_endereco} <br>
                        <strong>Comprovante de Renda:</strong> ${data.foto_contracheque} <br>
                    `;
                    document.getElementById('detailsContent').innerHTML = detalhes;

                    
                    const modal = new bootstrap.Modal(document.getElementById('detailsModal'));
                    modal.show();
                })
                .catch(error => {
                    console.error('Erro ao buscar os detalhes:', error);
                    document.getElementById('detailsContent').innerHTML = 'Erro ao carregar os detalhes.';
            });
    });
});
</script>
{% endblock %}
